---
title: 快速入门1-集成流
date: 2023-07-17T17:27:01
---

# 快速入门1 - 集成流

本文档将通过配一个调用高德地理编码接口的集成流，来展示系统的基本操作和概念。  
通过此文档，你会学会：  
1：如何新建配置集成流  
2：如何新建配置连接  
3：如何测试运行集成流

## 1\. 基本概念

|名词概念|释义|
|:---:|:---:|
|系统组件|指由iPaaS系统提供的功能组件，完成特定的功能和任务。如条件，循环等|
|连接器|指对一个应用的对外交互接口的封装，通常由该应用的多个行为组成。如玄武AI连接器，数据库连接器等|
|行为|即连接器行为，又分为执行行为和触发行为。如翻拍识别，SKU识别等；执行行为用于执行一个应用的接口；触发行为用于监听或接收应用的消息。|
|连接定义|用于定义某种应用的账号所需要的信息，用于在添加该应用账号时，生成对应的账号录入界面。如：微信账号，玄武AI账号等|
|连接|可用于登录某种应用的账号的信息。如小王的微信账号，xx公司的玄武AI账号|
|插件|包含了应用的登录，执行等方法的jar包|
|资源|插件上传后就会将其内部的方法注册为资源，登录的方法注册为链接资源，执行方法注册为执行资源。|
|集成流|由一个触发行为和多个执行行为和逻辑组件构成的，能完成特定业务处理流程行为集合。|
|私有|指某个数据属于指定的租户，其他的租户不能访问和使用。目前由租户管理员新建的数据（帐号类型，资源包，连接器）都默认是私有的。所有的集成流和应用账号都默认是私有的。|
|共有|指所有租户都能访问和使用的数据|

## 2\. 配置集成流

### 2.1 新建集成流

首先我们新建一个空白的集成流。

1. 选择【集成流】模块。进入系统后，默认就是进入集成流模块。
2. 选择应用。应用可以看做是集成流的分类。此处使用系统的【默认应用】。
3. 点击【新建集成流】。  
![](http://apaas.wxchina.com:8881/wp-content/uploads/11.png)
4. 填写集成流名称与说明
5. 点击【确定】按钮，系统就会新建一个集成流。  
![](http://apaas.wxchina.com:8881/wp-content/uploads/12.png)

### 2.2 设置触发行为

集成流是由多个节点构成，第一个节点为触发节点，一个集成流只会有一个触发节点，在该节点只能选择配置触发行为。  
此处将会选择HTTP监听作为触发行为，集成流发布后可以通过URL接口来触发该集成流。

1. 点击【设置触发行为】
2. 在弹出的列表中选择【HTTP连接器】。如果连接器较多可以通过搜索找到。
3. 选择【监听HTTP请求】行为。
4. 点击触发节点，弹出行为属性配置面板。
5. 将【返回方式】设置为【同步返回】。
6. 点击【编辑参数】按钮，编辑该集成流触发时所需要的入参。  
![](http://apaas.wxchina.com:8881/wp-content/uploads/14.png)
7. 点击【添加参数】，新增个参数
8. 输入参数名称以及标题
9. 点击【确定】按钮，完成集成流的入参编辑  
![](http://apaas.wxchina.com:8881/wp-content/uploads/15.png)

### 2.3 设置执行行为 - 地理编码

#### 2.3.1 新增执行节点

1. 点击【⊕】号按钮。
2. 在弹出的行为列表中切换到【应用连接器】
3. 选择其中的【高德】连接器
4. 选择【地理编码】行为

#### 2.3.2 添加连接

大部分的连接器都需要对应的连接才能使用，连接可以是账号密码，也可能是调用凭证。  
此处使用的高德接口的是平台开发的可供所有租户使用的连接器，为了避免过度调用导致触发高德的限制，因此连接中需要填入租户，以及调用配额等信息。其他的连接器通常不需要这些信息。

1. 在画布中点击【高德 - 地理编码】节点，打开属性面板。
2. 点击【添加新连接】，进入连接配置页面。  
   （如果已经有可用的连接，也可以直接选择使用，跳过新建的步骤）
3. 输入连接的名称，方便辨识。
4. 输入租户code和对应的高德key，以及每日调用配额，都是JSON格式  
   {"租户编码1": "高德key1", "租户编码2": "高德key2"}  
   （该插件会从实际调用的token中获取租户编码，并使用对应的key进行实际的调用）
5. 点击【确定】按钮保存连接设置。  
![](http://apaas.wxchina.com:8881/wp-content/uploads/17.png)

#### 2.3.3 配置执行节点参数

1. 选择刚才创建的连接
2. 点击【地址】输入框，弹出参数选择列表。该列表会列出上下文中所有可用的参数。
3. 在参数列表中选择前一个节点，也就是HTTP监听节点的参数【address】。
4. 输出示例是该节点的出参信息，此处信息是固定的返回高德接口的返回信息，也就是地址转换后的经纬度等信息。  
![](http://apaas.wxchina.com:8881/wp-content/uploads/18.png)

#### 2.4 设置返回数据

通过前面几个步骤的配置，已经可以将HTTP接收到的地址信息转换为编码信息，该步骤配置一个【结果输出】节点，配置集成需要返回的信息。

1. 添加第三个节点，从【逻辑组件】列表中，选择【输出结果】组件
2. 在输出结果的属性面板中添加一个输出参数，选择【展开Map】类型
3. 选择上一个节点输出的根节点作为输出内容。
4. 点击【保存】按钮，保存配置信息。至此集成流的配置就完成了。  
![](http://apaas.wxchina.com:8881/wp-content/uploads/19.png)

## 3\. 测试

配置完了集成流后，可以测试运行，如果触发行为是定时器，可以直接运行；如果是HTTP监听这种需要入参的，则需要创建一个测试用例，输入测试参数，再运行。

### 3.1 运行测试用例

1. 点击集成流的【运行】按钮。
2. 点击【添加测试用例】新增一个测试用例。如果已经有用例也可以直接运行。
3. 填写测试用例名称，方便辨识。
4. 编写用例入参，使用JSON格式编写。入参的内容就是触发节点【监听HTTP请求】的入参。
5. 点击【保存】按钮，保存该用例。
6. 点击【运行】按钮，运行该用例。  
![](http://apaas.wxchina.com:8881/wp-content/uploads/20.png)

### 3.2 查看运行日志

点击测试用例的【运行】按钮后即可查看运行日志。  
![](http://apaas.wxchina.com:8881/wp-content/uploads/21.png)

## 4\. 发布与调用

配置好的集成流在发布后，就可以在系统外部使用HTTP接口调用。此教程将使用postman模拟外部调用。  
aPaaS调用集成流的方法的详细介绍参看文档 iPaaS接口包装为aPaaS微服务简介  
目前iPaaS接口的鉴权只支持token，aPaaS系统的token可以直接用于集成流的调用。

### 4.1 发布

1. 点击【发布】按钮，正式发布该集成流
2. 点击触发节点，展开属性面板
3. 此处为接口信息，拷贝后用于外部调用。  
![](http://apaas.wxchina.com:8881/wp-content/uploads/22.png)

### 4.2 调用

1. 在postman中新建一个POST请求，并输入上方拷贝的API接口
2. 在请求头中添加token参数，该token用于调用鉴权，只要是有效的aPaaS系统token就行
3. 在body中填写集成流所需要的入参信息
4. 点击发送按钮
5. 成功调用后就能看到集成流返回的信息。  
![](http://apaas.wxchina.com:8881/wp-content/uploads/23.png)  
![](http://apaas.wxchina.com:8881/wp-content/uploads/24.png)

[本文引用](https://l654n890ds.feishu.cn/wiki/wikcnTu3WHVaZloNlJHumdC6fZc "iPaaS接口包装为aPaaS微服务简介")