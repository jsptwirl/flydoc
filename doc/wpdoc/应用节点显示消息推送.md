---
title: 应用节点显示消息推送
date: 2020-05-11T13:53:12
---

此功能需要更新web端至web V9.2.0及以上、APP端至9.0.0rc9及以上、messageserv（消息服务）至2.7.0及以上

# 应用节点显示消息推送

目前消息推送的红点提示统一显示在tab页签下的消息模块，现需要支持一种新模式：收到消息推送后，应用模块的某节点图标上显示红点（或其他类型角标）。  
  
UI图例：  
  
![](http://apaas.wxchina.com:8881/wp-content/uploads/%E5%BA%94%E7%94%A8%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%EF%BC%88%E4%B8%BB%E5%8A%A8%EF%BC%89.jpg)

#### 实现方式：消息内容的基本数据格式不变，通过"msgtype"字段和新增的"pagecode"字段决定红点显示位置。

发送通知内容

```json
//android发送通知内容
{
    "alert": "",//显示的摘要内容
    "title": "",//显示的title
    "extras": {
        "msgid": "",//额外字段,消息id
        "msgtype": "",//额外字段,消息类型
    }
}
//iOS发送通知内容
{
    "alert": {
        "body": "",//显示的内容
        "title": ""//显示的title
    },
    "extras": {
        "msgid": "",//额外字段,消息id
        "msgtype": "",//额外字段,消息类型
    },
    "badge": "",//角标
    "sound": ""//声音
}
```

getMsgTicket接口返回的消息详情

```json
{
    "msgid": "", //消息id
    "msgtitle": "", //消息的标题
    "msgsummary": "", //消息的摘要，推送消息时用
    "msgtype": "", //消息类型，组合编号，1001：1审批，001通知，002提醒
    "sender": "", //发送人code
    "sendername": "", //发送人姓名
    "senddatetime": "", //发送时间，13位时间戳
    "bizid": "", //业务id
    "dispalytemplate": "", //消息显示模板，组合编号，10011，1：默认显示标题；001：消息中间显示方式，001只有文字；1：能否查看详情，0不能，1能
    "jsondata": "" //消息附带的内容
    /*{
         "text":"",//消息中间显示的文字，需要与消息模板结合使用
         "image":[{//消息中间显示的图片，需要与消息模板结合使用
                   source:"",//图片的名字，xxxx.png/jpg
                   datetime:""//图片发送日期，13位时间戳
                 }],
         "param":{},//消息查看详情时传递的参数
         "pagecode":""//新增字段，表单code，对应应用模块节点配置的表单code
       }*/
}
```

## msgtype

消息类型，组合编号  
  
目前显示在消息模块的消息类型有：

1. 工作消息：1001、1002审批消息，3001日报，3002周报，3003月报
2. 资讯消息：4001通知公告
3. 终端表现智能推：5001-5004不同维度终端表现智能推送

现增加一种新的消息类型6001，当收到此类型的消息推送时，消息显示在应用界面，如对应节点（根据pagecode字段）有红点提示。

## pagecode

新增字段，表单code  
  
在"extras"或"jsondata"附带内容中增加一个"pagecode"字段，对应应用模块节点配置的表单code。  
  
当pagecode不为空时，接收到消息推送后，与pagecode相同的应用节点会有红点提示。